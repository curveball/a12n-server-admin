-- This file is a database dump that's the starting point for playwright tests.
PRAGMA foreign_keys=OFF;
BEGIN TRANSACTION;
CREATE TABLE `knex_migrations` (`id` integer not null primary key autoincrement, `name` varchar(255), `batch` integer, `migration_time` datetime);
INSERT INTO knex_migrations VALUES(1,'001_initial.js',1,1750123798552);
INSERT INTO knex_migrations VALUES(2,'002_oauth2.js',1,1750123798554);
INSERT INTO knex_migrations VALUES(3,'003_oauth-access-token.js',1,1750123798555);
INSERT INTO knex_migrations VALUES(4,'004_oauth-client-id.js',1,1750123798557);
INSERT INTO knex_migrations VALUES(5,'005_oauth2-redirect-uri.js',1,1750123798558);
INSERT INTO knex_migrations VALUES(6,'006_oauth-access-token2.js',1,1750123798559);
INSERT INTO knex_migrations VALUES(7,'007_oauth-client-user.js',1,1750123798560);
INSERT INTO knex_migrations VALUES(8,'008_oauth2-secret-size.js',1,1750123798573);
INSERT INTO knex_migrations VALUES(9,'009_permissions-schema.js',1,1750123798573);
INSERT INTO knex_migrations VALUES(10,'010_privileges.js',1,1750123798574);
INSERT INTO knex_migrations VALUES(11,'011_user-type.js',1,1750123798579);
INSERT INTO knex_migrations VALUES(12,'012_userlog2.js',1,1750123798580);
INSERT INTO knex_migrations VALUES(13,'013_userlog3.js',1,1750123798583);
INSERT INTO knex_migrations VALUES(14,'014_oauth2-code.js',1,1750123798583);
INSERT INTO knex_migrations VALUES(15,'020_oauth2-client-id-int.js',1,1750123798588);
INSERT INTO knex_migrations VALUES(16,'021_access-token-fix.js',1,1750123798592);
INSERT INTO knex_migrations VALUES(17,'022_longer-allowed-grant-types.js',1,1750123798595);
INSERT INTO knex_migrations VALUES(18,'023_server-settings.js',1,1750123798595);
INSERT INTO knex_migrations VALUES(19,'024_registration-enabled.js',1,1750123798596);
INSERT INTO knex_migrations VALUES(20,'025_privilege-resources.js',1,1750123798597);
INSERT INTO knex_migrations VALUES(21,'026_reset-password-token.js',1,1750123798598);
INSERT INTO knex_migrations VALUES(22,'027_userlog3.js',1,1750123798599);
INSERT INTO knex_migrations VALUES(23,'028_group-member.js',1,1750123798600);
INSERT INTO knex_migrations VALUES(24,'029_group-members2.js',1,1750123798603);
INSERT INTO knex_migrations VALUES(25,'030_totp-setting.js',1,1750123798603);
INSERT INTO knex_migrations VALUES(26,'031_expiry-settings.js',1,1750123798604);
INSERT INTO knex_migrations VALUES(27,'032_privilege-settings.js',1,1750123798604);
INSERT INTO knex_migrations VALUES(28,'033_privilege-field-change.js',1,1750123798605);
INSERT INTO knex_migrations VALUES(29,'034_oauth2-codes-pkce.js',1,1750123798606);
INSERT INTO knex_migrations VALUES(30,'035_webauthn-registration.js',1,1750123798607);
INSERT INTO knex_migrations VALUES(31,'036_webauthn-setting.js',1,1750123798608);
INSERT INTO knex_migrations VALUES(32,'037_totp-registration.js',1,1750123798609);
INSERT INTO knex_migrations VALUES(33,'038_webauthn-enable.js',1,1750123798610);
INSERT INTO knex_migrations VALUES(34,'039_oauth-token-session.js',1,1750123798611);
INSERT INTO knex_migrations VALUES(35,'040_log-country.js',1,1750123798611);
INSERT INTO knex_migrations VALUES(36,'041_default-landing-page.js',1,1750123798612);
INSERT INTO knex_migrations VALUES(37,'042_user-to-principal.js',1,1750123798617);
INSERT INTO knex_migrations VALUES(38,'20220401022610_external-id.js',1,1750123798621);
INSERT INTO knex_migrations VALUES(39,'20220401043138_password-varchar.js',1,1750123798623);
INSERT INTO knex_migrations VALUES(40,'20220503012552_fix-type-constraint.js',1,1750123798626);
INSERT INTO knex_migrations VALUES(41,'20220911163800_clean_types.js',1,1750123798630);
INSERT INTO knex_migrations VALUES(42,'20220911180000_token_metadata.js',1,1750123798632);
INSERT INTO knex_migrations VALUES(43,'20221002160500_auth_code_scopes.js',1,1750123798634);
INSERT INTO knex_migrations VALUES(44,'20221002165500_user_app.js',1,1750123798635);
INSERT INTO knex_migrations VALUES(45,'20221101044211_add_nonce.js',1,1750123798635);
INSERT INTO knex_migrations VALUES(46,'20230924194452_all_users.js',1,1750123798636);
INSERT INTO knex_migrations VALUES(47,'20230925041530_new_privileges.js',1,1750123798637);
INSERT INTO knex_migrations VALUES(48,'20231108041315_sqlite_wal_mode.js',1,1750123798637);
INSERT INTO knex_migrations VALUES(49,'20231109012626_new_privileges.js',1,1750123798638);
INSERT INTO knex_migrations VALUES(50,'20231121134632_new_privileges.js',1,1750123798638);
INSERT INTO knex_migrations VALUES(51,'20240712214300_principal_identity.js',1,1750123798644);
INSERT INTO knex_migrations VALUES(52,'20240714224300_identity_uri.js',1,1750123798652);
INSERT INTO knex_migrations VALUES(53,'20240726000800_more_allowed_grant_types.js',1,1750123798655);
INSERT INTO knex_migrations VALUES(54,'20240726001900_oauth2_client_rename.js',1,1750123798658);
INSERT INTO knex_migrations VALUES(55,'20240730113100_oauth2_code_redirect.js',1,1750123798661);
INSERT INTO knex_migrations VALUES(56,'20240908210700_block_failed_login_attempts.js',1,1750123798662);
INSERT INTO knex_migrations VALUES(57,'20241027202400_new_privileges.js',1,1750123798662);
INSERT INTO knex_migrations VALUES(58,'20241220003200_identity_mfa.js',1,1750123798663);
INSERT INTO knex_migrations VALUES(59,'20250109120700_new_privileges.js',1,1750123798663);
INSERT INTO knex_migrations VALUES(60,'20250527182122-new-privileges.ts.js',1,1750123798663);
INSERT INTO knex_migrations VALUES(61,'20251740066033_user_info.js',1,1750123798664);
CREATE TABLE `knex_migrations_lock` (`index` integer not null primary key autoincrement, `is_locked` integer);
INSERT INTO knex_migrations_lock VALUES(1,0);
CREATE TABLE `changelog` (`id` integer, `timestamp` integer, primary key (`id`));
INSERT INTO changelog VALUES(1,1750123798);
INSERT INTO changelog VALUES(2,1750123798);
INSERT INTO changelog VALUES(3,1750123798);
INSERT INTO changelog VALUES(4,1750123798);
INSERT INTO changelog VALUES(5,1750123798);
INSERT INTO changelog VALUES(6,1750123798);
INSERT INTO changelog VALUES(7,1750123798);
INSERT INTO changelog VALUES(8,1750123798);
INSERT INTO changelog VALUES(9,1750123798);
INSERT INTO changelog VALUES(10,1750123798);
INSERT INTO changelog VALUES(11,1750123798);
INSERT INTO changelog VALUES(12,1750123798);
INSERT INTO changelog VALUES(13,1750123798);
INSERT INTO changelog VALUES(14,1750123798);
INSERT INTO changelog VALUES(20,1750123798);
INSERT INTO changelog VALUES(21,1750123798);
INSERT INTO changelog VALUES(22,1750123798);
INSERT INTO changelog VALUES(23,1750123798);
INSERT INTO changelog VALUES(24,1750123798);
INSERT INTO changelog VALUES(25,1750123798);
INSERT INTO changelog VALUES(26,1750123798);
INSERT INTO changelog VALUES(27,1750123798);
INSERT INTO changelog VALUES(28,1750123798);
INSERT INTO changelog VALUES(29,1750123798);
INSERT INTO changelog VALUES(30,1750123798);
INSERT INTO changelog VALUES(31,1750123798);
INSERT INTO changelog VALUES(32,1750123798);
INSERT INTO changelog VALUES(33,1750123798);
INSERT INTO changelog VALUES(34,1750123798);
INSERT INTO changelog VALUES(35,1750123798);
INSERT INTO changelog VALUES(36,1750123798);
INSERT INTO changelog VALUES(37,1750123798);
INSERT INTO changelog VALUES(38,1750123798);
INSERT INTO changelog VALUES(39,1750123798);
INSERT INTO changelog VALUES(40,1750123798);
INSERT INTO changelog VALUES(41,1750123798);
INSERT INTO changelog VALUES(42,1750123798);
CREATE TABLE `oauth2_redirect_uris` (`id` integer not null primary key autoincrement, "app_client_id" integer not null, `uri` varchar(300) not null);
INSERT INTO oauth2_redirect_uris VALUES(1,1,'http://localhost:5173/auth/redirect');
CREATE TABLE `user_privileges` (`id` integer not null primary key autoincrement, `user_id` integer not null, "privilege" varchar(50) not null, `resource` varchar(255) not null default '*');
INSERT INTO user_privileges VALUES(1,2,'admin','*');
CREATE TABLE IF NOT EXISTS "user_log" (`id` integer PRIMARY KEY AUTOINCREMENT NOT NULL, `time` integer NOT NULL, `user_id` integer, `event_type` tinyint NOT NULL, `ip` varchar(45) NOT NULL, user_agent TEXT NULL, country VARCHAR(2) NULL);
INSERT INTO user_log VALUES(1,1750123818,2,18,'::ffff:127.0.0.1','Mozilla/5.0 (X11; Linux x86_64; rv:139.0) Gecko/20100101 Firefox/139.0',NULL);
INSERT INTO user_log VALUES(2,1750123818,2,1,'::ffff:127.0.0.1','Mozilla/5.0 (X11; Linux x86_64; rv:139.0) Gecko/20100101 Firefox/139.0',NULL);
CREATE TABLE server_settings (
  setting VARCHAR(200) NOT NULL PRIMARY KEY,
  value VARCHAR(2000)
);
INSERT INTO server_settings VALUES('registration.enabled','true');
INSERT INTO server_settings VALUES('totp','"optional"');
INSERT INTO server_settings VALUES('oauth2.accessToken.expiry','600');
INSERT INTO server_settings VALUES('oauth2.refreshToken.expiry','21600');
INSERT INTO server_settings VALUES('oauth2.code.expiry','600');
INSERT INTO server_settings VALUES('registration.mfa.enabled','true');
INSERT INTO server_settings VALUES('webauthn.relyingPartyId',NULL);
INSERT INTO server_settings VALUES('webauthn.expectedOrigin',NULL);
INSERT INTO server_settings VALUES('webauthn.serviceName','"a12n-server"');
INSERT INTO server_settings VALUES('webauthn','"enabled"');
INSERT INTO server_settings VALUES('totp.serviceName','"a12n-server"');
INSERT INTO server_settings VALUES('login.defaultRedirect','"/"');
CREATE TABLE IF NOT EXISTS "verification_token" (`id` integer not null primary key autoincrement, "principal_id" integer not null, `token` varchar(100) not null, `expires_at` integer not null, `created_at` integer not null, `single_use` tinyint not null default '0', `principal_identity_id` integer null);
CREATE TABLE IF NOT EXISTS "group_members" (`user_id` integer NOT NULL, `group_id` integer NOT NULL, PRIMARY KEY (`user_id`, `group_id`));
CREATE TABLE privileges (
  privilege VARCHAR(200) NOT NULL PRIMARY KEY,
  description VARCHAR(2000) NOT NULL
);
INSERT INTO privileges VALUES('admin','Full admin privileges on the authenciation server');
INSERT INTO privileges VALUES('a12n:user:read-auth-factors','Read what kind of authentication credentials a user has set up.');
INSERT INTO privileges VALUES('a12n:one-time-token:generate','Create a token for an arbitrary user, this token grants full access to this account.');
INSERT INTO privileges VALUES('a12n:one-time-token:exchange','Exchange a one-time-token for a OAuth2 access token.');
INSERT INTO privileges VALUES('a12n:user:change-password','Allow changing a users'' password.');
INSERT INTO privileges VALUES('a12n:access-token:generate','Allows a user to create a valid access-token for another user without consent. This privilege allows full control of other accounts and should never be given to third parties.');
INSERT INTO privileges VALUES('a12n:user:manage-identities','Full control over a user identities, including adding, deleting, setting and removing verification status.');
CREATE TABLE `user_webauthn` (`id` integer not null primary key autoincrement, `user_id` integer not null, `credential_id` varchar(2000) not null, `public_key` varchar(2000) not null, `counter` integer not null, `created` integer not null);
CREATE TABLE IF NOT EXISTS "user_passwords" (`user_id` integer NOT NULL, `password` varchar(60) NOT NULL, PRIMARY KEY (`user_id`));
INSERT INTO user_passwords VALUES(2,'$2b$12$f5BiBeC72/ElwsjOGbDJKuUTGZIFoXWhx.0hKO838MaCZ.EjO/XY6');
CREATE TABLE IF NOT EXISTS "user_totp" (`user_id` integer NOT NULL, `secret` varchar(255) NOT NULL, `failures` tinyint NOT NULL DEFAULT '0', `created` integer NOT NULL DEFAULT '0', PRIMARY KEY (`user_id`));
CREATE TABLE IF NOT EXISTS "oauth2_tokens" (`id` integer PRIMARY KEY AUTOINCREMENT NOT NULL, "app_client_id" integer NOT NULL, `access_token` varchar(2000) NOT NULL, `refresh_token` varchar(50) NOT NULL, `user_id` integer NOT NULL, `access_token_expires` integer NOT NULL, `refresh_token_expires` integer NOT NULL, "created_at" integer NOT NULL, `browser_session_id` VARCHAR(200) NULL, `grant_type` tinyint null, `scope` varchar(1024) null);
CREATE TABLE `user_app_permissions` (`id` integer not null primary key autoincrement, `app_id` integer not null, `user_id` integer not null, `scope` varchar(1024), `created_at` bigint not null, `modified_at` bigint not null, `last_used_at` bigint null);
CREATE TABLE IF NOT EXISTS "principals" (`id` integer PRIMARY KEY AUTOINCREMENT NOT NULL, `identity` varchar(255), `nickname` varchar(255), `created_at` bigint NOT NULL, `active` boolean NOT NULL DEFAULT '0', `type` tinyint NOT NULL, `modified_at` bigint NOT NULL, `external_id` varchar(255) NOT NULL, `system` tinyint NOT NULL DEFAULT '0');
INSERT INTO principals VALUES(1,'urn:uuid:5793d1ce-d21e-4955-9091-c2b9debb9ec1','All Users',1750123798636,1,3,1750123798636,'$all',1);
INSERT INTO principals VALUES(2,NULL,'Admin',1750123813630,1,1,1750123813630,'G6f5cGMNo04',0);
INSERT INTO principals VALUES(3,NULL,'Admin UI app',1750123841251,1,2,1750123841251,'kEqMxi5PpTE',0);
CREATE TABLE IF NOT EXISTS "principal_identities" (`id` integer PRIMARY KEY AUTOINCREMENT NOT NULL, `uri` varchar(200) NOT NULL, `principal_id` integer NOT NULL, `is_primary` tinyint NOT NULL, `label` varchar(50) NULL, `verified_at` bigint NULL, `created_at` bigint NOT NULL, `modified_at` bigint NOT NULL, `external_id` varchar(11) NOT NULL, `is_mfa` tinyint not null default '0', FOREIGN KEY (`principal_id`) REFERENCES `principals` (`id`));
INSERT INTO principal_identities VALUES(1,'urn:uuid:5793d1ce-d21e-4955-9091-c2b9debb9ec1',1,1,NULL,1750123798639,1750123798636,1750123798636,'xwYELZwY0CY',0);
INSERT INTO principal_identities VALUES(2,'mailto:admin@example.com',2,1,NULL,1750123813837,1750123813837,1750123813837,'NvDn8f8da9w',0);
INSERT INTO principal_identities VALUES(3,'http://localhost:5173/',3,1,NULL,NULL,1750123841255,1750123841255,'vOrg4p4fP-4',0);
CREATE TABLE IF NOT EXISTS "app_clients" (`id` integer PRIMARY KEY AUTOINCREMENT NOT NULL, `client_id` varchar(50) NOT NULL, `client_secret` varchar(60) NOT NULL, `allowed_grant_types` varchar(200) NOT NULL, `user_id` integer NOT NULL, `require_pkce` boolean NOT NULL);
INSERT INTO app_clients VALUES(1,'playwright-test','$2b$12$OrhmgBgvTE5jC.VhwhbtW.NJ1lyVnfxDnVXuvMIceADULZBXCnbZu','authorization_code refresh_token',3,0);
CREATE TABLE IF NOT EXISTS "oauth2_codes" (`id` integer PRIMARY KEY AUTOINCREMENT NOT NULL, `client_id` integer NOT NULL, `code` varchar(50) NOT NULL, `principal_id` integer NOT NULL, `created_at` integer NOT NULL, `code_challenge` varchar(50) NULL, `code_challenge_method` varchar(50) NULL, `browser_session_id` VARCHAR(200) NULL, `scope` varchar(1024) NULL, `nonce` varchar(100) NULL, `redirect_uri` varchar(300), `grant_type` tinyint NOT NULL);
CREATE TABLE `user_login_activity` (`principal_id` integer not null, `failed_login_attempts` integer not null default '0', `account_locked` boolean not null default '0', foreign key(`principal_id`) references `principals`(`id`) on delete CASCADE, primary key (`principal_id`));
INSERT INTO user_login_activity VALUES(2,0,0);
CREATE TABLE `user_info` (`principal_id` integer not null, `name` varchar(200) null, `middle_name` varchar(255) null, `given_name` varchar(30) null, `family_name` varchar(30) null, `birthdate` date null, `address` text null, `locale` varchar(5) null, `zoneinfo` varchar(255) null, `created_at` bigint, `modified_at` bigint null, `metadata` text, foreign key(`principal_id`) references `principals`(`id`), primary key (`principal_id`));
INSERT INTO sqlite_sequence VALUES('knex_migrations_lock',1);
INSERT INTO sqlite_sequence VALUES('knex_migrations',61);
INSERT INTO sqlite_sequence VALUES('oauth2_redirect_uris',1);
INSERT INTO sqlite_sequence VALUES('user_privileges',1);
INSERT INTO sqlite_sequence VALUES('user_log',2);
INSERT INTO sqlite_sequence VALUES('oauth2_tokens',0);
INSERT INTO sqlite_sequence VALUES('principals',3);
INSERT INTO sqlite_sequence VALUES('principal_identities',3);
INSERT INTO sqlite_sequence VALUES('app_clients',1);
INSERT INTO sqlite_sequence VALUES('oauth2_codes',0);
CREATE UNIQUE INDEX `reset_password_token_token_unique` on "verification_token" (`token`);
CREATE UNIQUE INDEX `oauth2_tokens_access_token_unique` on `oauth2_tokens` (`access_token`);
CREATE UNIQUE INDEX `oauth2_tokens_refresh_token_unique` on `oauth2_tokens` (`refresh_token`);
CREATE UNIQUE INDEX `user_app_permissions_app_id_user_id_unique` on `user_app_permissions` (`app_id`, `user_id`);
CREATE UNIQUE INDEX `principals_external_id_unique` on `principals` (`external_id`);
CREATE UNIQUE INDEX `principal_identities_href_unique` on `principal_identities` ("uri");
CREATE UNIQUE INDEX `oauth2_clients_client_id_unique` on "app_clients" (`client_id`);
COMMIT;
